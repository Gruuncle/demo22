<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>会员信息</title>
	<link type="text/css" rel="stylesheet" href="/stylesheets/fontsawesome/css/font-awesome.css" />
	<link type="text/css" rel="stylesheet" href="/stylesheets/css/style.css" />
</head>

<body>
	<div class="main_box">
		<h2><span></span>会员信息</h2>
		<div class="search_box clearfix" style="position: relative">
			<label class="f_left">搜索会员：</label>
			<input type="search" placeholder="会员姓名" class="f_left search_input" />
			<input type="button" value="搜索" class="btn blue_btn search" />
			<select name="" id="user" style="display: none">
				<option value="">未选择</option>
			</select>
		</div>
		<div class="first"><span style="font-size: 2rem;font-weight: 800;margin-left: 20px;margin-top: 20px">请选择会员</span></div>
		<div class="cont_box" style="display:none">
			<ul class="tab_tit clearfix">
				<li>会员基本信息</li>
				<li>爱车</li>
				<li>储值卡</li>
				<li>年卡</li>
				<!-- <li>大礼包</li> -->
				<li>消费记录</li>
				<!-- <li>积分记录</li> -->
			</ul>
			<dl class="tab_conbox">
				<!--会员基本信息-->
				<dd class="dd_first">
					<!-- <form action="" method="post" id="edit_user">
						<div class="addpro_box clearfix" id="6">
							<label>姓名：</label>
							<input type="text" value="张三" name="username" required data-rule-fullname="true" data-msg-required="会员姓名不能为空" />
						</div>
						<div class="addpro_box clearfix">
							<label>手机号：</label>
							<input type="text" value="18636542369" name="phone" required data-rule-mobile="true" data-msg-required="会员手机号不能为空" />
						</div>
						<div class="addpro_box clearfix">
							<label>所属门店：</label>
							<input type="text" name="fullname" value="西航店" readonly />
						</div>
						<div class="probtn_box clearfix">
							<input type="button" value="保存修改" class="btn blue_btn submit_user">
						</div>
					</form> -->
				</dd>
				<!--爱车-->
				<dd class="dd_two">
					<div class="margin_tb clearfix">
						<button type="button" class="btn blue_btn add_car">添加爱车</button>
					</div>
					<!--爱车信息-->
					<!-- <div class="ucar_list">
						<h5>
							<span>爱车编号001</span>
							<a href="javascript:void(0);" class="edit_car">编辑车辆信息</a>
							<a href="javascript:void(0);" class="del_car">删除车辆</a>
						</h5>
						<table border="0" cellspacing="0" cellpadding="0" class="table">
							<tbody>
								<tr>
									<td>品牌</td>
									<td>宝马</td>
									<td>系列</td>
									<td>宝马（进口）</td>
								</tr>
								<tr>
									<td>型号</td>
									<td>宝马Z3</td>
									<td>发动机号</td>
									<td>568441312666</td>
								</tr>
								<tr>
									<td>车牌号</td>
									<td></td>
									<td>车架号</td>
									<td></td>
								</tr>
								<tr>
									<td>行驶证</td>
									<td></td>
									<td>年份</td>
									<td></td>
								</tr>
								<tr>
									<td>指导价</td>
									<td></td>
									<td>保险到期日</td>
									<td></td>
								</tr>
							</tbody>
						</table>
					</div> -->
					<!-- <div class="ucar_list">
						<h5>
							<span>爱车编号002</span>
							<a href="javascript:void(0);" class="edit_car">编辑车辆信息</a>
							<a href="javascript:void(0);" class="del_car">删除车辆</a>
						</h5>
						<table border="0" cellspacing="0" cellpadding="0" class="table">
							<tbody>
								<tr>
									<td>品牌</td>
									<td>宝马</td>
									<td>系列</td>
									<td>宝马（进口）</td>
								</tr>
								<tr>
									<td>型号</td>
									<td>宝马Z3</td>
									<td>发动机号</td>
									<td>568441312666</td>
								</tr>
								<tr>
									<td>车牌号</td>
									<td></td>
									<td>车架号</td>
									<td></td>
								</tr>
								<tr>
									<td>行驶证</td>
									<td></td>
									<td>年份</td>
									<td></td>
								</tr>
								<tr>
									<td>指导价</td>
									<td></td>
									<td>保险到期日</td>
									<td></td>
								</tr>
							</tbody>
						</table>
					</div> -->
				</dd>
				<!--储值卡-->
				<dd>
					<!--当前储值卡为空时显示添加按钮-->
					<div class="margin_tb clearfix">
						<button type="button" class="btn blue_btn add_pcard">添加储值卡</button>
					</div>
					<table border="0" cellspacing="0" cellpadding="0" class="table">
						<thead>
							<tr>
								<th>用户手机号</th>
								<th>卡片ID</th>
								<th>卡片余额</th>
								<th>卡片折扣</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody class="dd_san">

						</tbody>
					</table>
				</dd>
				<!--年卡-->
				<dd>
					<!--当前年为空时显示添加按钮-->
					<div class="margin_tb clearfix">
						<button type="button" class="btn blue_btn add_ycard">添加年卡</button>
					</div>
					<table border="0" cellspacing="0" cellpadding="0" class="table">
						<thead>
							<tr>
								<th>用户手机号</th>
								<th>用户姓名</th>
								<th>卡片额度</th>
								<!-- <th>绑定车牌号</th> -->
								<th>办理日期</th>
								<th>过期日期</th>
								<th>状态</th>
							</tr>
						</thead>
						<tbody class="dd_si">
							<!-- <tr>
								<td>13666666666</td>
								<td>张三</td>
								<td>2000</td>
								<td>晋A12345</td>
								<td>2017-03-01</td>
								<td>2017-05-31</td>
								<td>可用</td>
							</tr> -->

						</tbody>
					</table>
				</dd>
				<!--大礼包-->
				<!-- <dd>
						<div class="margin_tb clearfix">
							<button type="button" class="btn blue_btn add_spree">添加大礼包</button>
						</div>
						<table border="0" cellspacing="0" cellpadding="0" class="table">
							<thead>
								<tr>
									<th>用户手机号</th>
									<th>大礼包</th>
									<th>大礼包价格</th>
									<th>办理日期</th>
									<th>过期日期</th>
									<th>大礼包详情</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>13666666666</td>
									<td>张三</td>
									<td>2000</td>
									<td>2017-03-01</td>
									<td>2017-05-31</td>
									<td>可用</td>
								</tr>
								<tr>
									<td>13888888888</td>
									<td>王五</td>
									<td>300000</td>
									<td>2017-03-15</td>
									<td>2017-03-30</td>
									<td>已过期</td>
								</tr>
							</tbody>
						</table>
					</dd> -->
				<!--消费记录-->
				<dd>
					<table border="0" cellspacing="0" cellpadding="0" class="table">
						<thead>
							<tr>
								<th>订单号</th>
								<th>消费金额</th>
								<th>会员</th>
								<th>手机号</th>
								<th>支付</th>
								<th>状态</th>
								<th>开单日期</th>
								<th>订单备注</th>
								<th>所属门店</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>58C8F2EDCAD25</td>
								<td>2000</td>
								<td>张三</td>
								<td>13666666666</td>
								<td>会员</td>
								<td>已支付</td>
								<td>2017-05-31</td>
								<td>备注一下</td>
								<td>太原火车站店</td>
							</tr>
							<tr>
								<td>58C8F2EDCAD25</td>
								<td>2000</td>
								<td>张三</td>
								<td>13666666666</td>
								<td>会员</td>
								<td>已支付</td>
								<td>2017-05-31</td>
								<td>备注</td>
								<td>太原火车站店</td>
							</tr>
						</tbody>
					</table>
				</dd>
				<!--积分记录-->
				<!-- <dd>
						<table border="0" cellspacing="0" cellpadding="0" class="table">
							<thead>
								<tr>
									<th>会员</th>
									<th>手机号</th>
									<th>原积分</th>
									<th>状态</th>
									<th>积分变动</th>
									<th>当前积分</th>
									<th>操作类型</th>
									<th>操作日期</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>张三</td>
									<td>13666666666</td>
									<td>2000</td>
									<td>增加</td>
									<td>800</td>
									<td>2800</td>
									<td>首次添加爱车</td>
									<td>2017-05-31</td>
								</tr>
								<tr>
									<td>张三</td>
									<td>13666666666</td>
									<td>1000</td>
									<td>增加</td>
									<td>1000</td>
									<td>2000</td>
									<td>绑定</td>
									<td>2017-05-31</td>
								</tr>
							</tbody>
						</table>
					</dd> -->
			</dl>
		</div>
	</div>
	<!--javascript include-->
	<script src="/javascripts/jquery-2.2.1.min.js"></script>
	<script src="/javascripts/jquery.dataTables.min.js"></script>
	<script src="/javascripts/bootstrap-datepicker.js"></script>
	<script src="/javascripts/jquery.validate.min.js"></script>
	<script src="/javascripts/other.js"></script>
	<script>
		$(function () {
			$.jqtab(".tab_tit", ".tab_conbox", "click");
			var addCar = "", //添加爱车时所需id
				editCar = "", //添加爱车时所需id
				delCar = "", //添加爱车时所需id
				addYcard = "", //添加爱车时所需id
				addPcard = "", //添加爱车时所需id
				delPcard = ""; //添加爱车时所需id



			//查询会员获取信息
			var userId = ''; //会员id
			// console.log(userId)
			$(".search").click(function () {
				$.ajax({
					type: "post",
					url: "/api/user/like_user",
					data: {
						"username": $('.search_input').val()
					},
					success: function (data) {
						var res = JSON.parse(data)
						// debugger
						if (res.code == 0) {
							$('#user').show();

							var html = '';
							for (var i in res.data) {
								html += `<option value="${res.data[i].id}">${res.data[i].username }</option>`
							}
							$('#user').html(html)
						}
						userId = $('#user').val();
						// console.log(userId)
					},
					error: function (data) {
						alert("查询失败，请重试！");
					}
				});
			});
			
			
			$('#user').on('change', function () {
				userId = $('#user').val();
				addCar = userId;
				addPcard = userId;
				addYcard = userId;
				$('.first').hide();
				$('.cont_box').show();
				var user_phone = '';
				var user_name = '';
				// 会员基本信息
				var html1 = '';
				$.ajax({
					type: 'post',
					url: '/api/user/selectuserbyid',
					data: {
						'id': userId
					},
					success: function (e) {
						var res = JSON.parse(e);
						// debugger
						for (var i in res.data) {
							html1 +=
								`	<form action="" method="post" id="edit_user">
						<div class="addpro_box clearfix" id="${res.data[i].id}">
							<label>姓名：</label>
							<input type="text" value="${res.data[i].username}" name="username" required data-rule-fullname="true" data-msg-required="会员姓名不能为空" />
						</div>
						<div class="addpro_box clearfix">
							<label>手机号：</label>
							<input type="text" value="${res.data[i].phone}" name="phone" required data-rule-mobile="true" data-msg-required="会员手机号不能为空" />
						</div>
						<div class="addpro_box clearfix">
							<label>所属门店：</label>
							<input type="text" name="fullname" value="西航店" readonly />
						</div>
						<div class="probtn_box clearfix">
							<input type="button" value="保存修改" class="btn blue_btn submit_user">
						</div>
					</form>`
						}
						$('.dd_first').html(html1);
						user_phone = $('[name="phone"]').val()
						user_name = $('[name="username"]').val();
						$("body").other({
							formId: "#edit_user",
							formUrl: "#"
						}); //formUrl 表单请求地址,linkHref 请求成功后跳转地址，此页面不需要，已删除
					}
				})

				// 爱车
				var html2 = '';
				$.ajax({
					type: 'post',
					url: '/api/user/selectcarbyid',
					data: {
						'id': userId
					},
					success: function (e) {
						var res = JSON.parse(e);
						// debugger
						for (var i in res.data) {
							html2 +=
								`<div class="ucar_list">
						<h5>
							<span>爱车编号000${i}</span>
							<a href="javascript:void(0);" class="edit_car" id=${res.data[i].id}>编辑车辆信息</a>
							<a href="javascript:void(0);" class="del_car" id=${res.data[i].id}>删除车辆</a>
						</h5>
						<table border="0" cellspacing="0" cellpadding="0" class="table">
							<tbody>
								<tr id=${res.data[i].id}>
									<td>品牌</td>
									<td>${res.data[i].brand}</td>
									<td>系列</td>
									<td>${res.data[i].xilie}</td>
								</tr>
								<tr>
									<td>型号</td>
									<td>${res.data[i].xinghao}</td>
									<td>发动机号</td>
									<td></td>
								</tr>
								<tr>
									<td>车牌号</td>
									<td>${res.data[i].car_number}</td>
									<td>车架号</td>
									<td></td>
								</tr>
								<tr>
									<td>行驶证</td>
									<td></td>
									<td>年份</td>
									<td></td>
								</tr>
								<tr>
									<td>指导价</td>
									<td></td>
									<td>保险到期日</td>
									<td>${res.data[i].baoxian_time.split('T')[0]}</td>
								</tr>
							</tbody>
						</table>
					</div>`

						}

						$('.dd_two').append(html2);
						$("body").tipWindow({
							method: "edit_car",
							type: "form",
							Class: ".edit_car",
							even: "click",
							dataId: editCar,
							tipTit: "编辑爱车",
							Twidth: "700",
							Theight: "520",
							editUrl: "/html/edit_Car.html"
						}); //editUrl 编辑爱车请求地址
						$("body").tipWindow({
							method: "delete_car",
							Class: ".del_car",
							even: "click",
							dataId: delCar,
							Twidth: "400",
							Theight: "180",
							delUrl: "/api/user/delecd_usercar"
						}); //delUrl 删除爱车请求地址
						$("body").tipWindow({
							method: "edit",
							type: "form",
							Class: ".add_car",
							even: "click",
							dataId: addCar,
							tipTit: "添加爱车",
							Twidth: "700",
							Theight: "520",
							editUrl: "/html/add_Car.html"
						}); //editUrl 添加爱车请求地址

					}
				})

				// 存储卡
				var html3 = '';
				$.ajax({
					type: 'post',
					url: '/api/user/selectcunxucardbyid',
					data: {
						'id': userId
					},
					success: function (e) {
						var res = JSON.parse(e)
						// debugger
						for (var i in res.data) {
							html3 +=
								`<tr id="${res.data[i].id}">
								<!--这里id为卡片操作时需要-->
								<td>${user_phone}</td>
								<td>${res.data[i].card_id}</td>
								<td>${res.data[i].card_yue}</td>
								<td>${res.data[i].card_zhekou}</td>
								<td>
									<a href="javascript:void(0);" class="table_btn table_info recharge_btn">
										<i class="fa fa-mail-forward"></i>
										<span>卡片充值</span>
									</a>
									<a href="javascript:void(0);" class="table_btn table_del del_btn">
										<i class="fa fa-trash-o"></i>
										<span>删除卡片</span>
									</a>
								</td>
							</tr>`
						}
						$('.dd_san').html(html3)
						$("body").tipWindow({
							method: "edit",
							type: "form",
							Class: ".add_pcard",
							even: "click",
							dataId: addPcard,
							tipTit: "添加储值卡",
							Twidth: "600",
							Theight: "400",
							editUrl: "/html/add_Pcard.html"
						}); //editUrl 添加储值卡请求地址
						$("body").tipWindow({
							method: "delete",
							Class: ".del_btn",
							even: "click",
							Twidth: "400",
							dataId: delPcard,
							Theight: "180",
							delUrl: "/api/user/delecd_chucuncard"
						}); //delUrl 删除储值卡请求地址
						$("body").tipWindow({
							method: "edit",
							type: "form",
							Class: ".recharge_btn",
							even: "click",
							tipTit: "储值卡充值",
							Twidth: "600",
							Theight: "300",
							editUrl: "/html/pcard_Recharge.html"
						}); //editUrl 储值卡充值请求地址

					}
				})

				// 年卡
				var html4 = '';
				$.ajax({
					type: 'post',
					url: '/api/user/selectyearcardbyid',
					data: {
						'id': userId
					},
					success: function (e) {
						var res = JSON.parse(e)
						// debugger
						for (var i in res.data) {
							if (res.data[i].state == 1) {
								res.data[i].state = '可用'
							} else {
								res.data[i].state = '已过期'
							}
							html4 +=
								`<tr>
								<td>${user_phone}</td>
								<td>${user_name}</td>
								<td>${res.data[i].card_edu}</td>
								<td>${res.data[i].start_time.split('T')[0]}</td>
								<td>${res.data[i].end_time.split('T')[0]}</td>
								<td>${res.data[i].state}</td>
							</tr>`
						}
						$('.dd_si').html(html4)
						$("body").tipWindow({
							method: "edit",
							type: "form",
							Class: ".add_ycard",
							even: "click",
							dataId: addYcard,
							tipTit: "添加年卡",
							Twidth: "600",
							Theight: "400",
							editUrl: "/html/add_Ycard.html"
						}); //editUrl 添加年卡请求地址
					}
				})



			})

		});
	</script>
</body>

</html>